locals{
  AppID                          =   "${var.AppID}"
  AppRole                       =   "${var.AppRole}"
  Environment                   =   "${var.Environment}"
  Version                       =   "${var.Version}"
  Cluster                       =   "${var.Cluster}"
  StartingDate                  =   "${var.StartingDate}"
  Owner                         =   "${var.Owner}"
  Tenant                        =   "${var.Tenant}"
  CostCenter                    =   "${var.CostCenter}"
  Costumer                      =   "${var.Costumer}"
  Confidentiality               =   "${var.Confidentiality}"
  ProjectName                   =   "${var.ProjectName}"
  Compliance                    =   "${var.Compliance}"
  Requestor                     =   "${var.Requestor}"
  BusinessOwner                  =   "${var.BusinessOwner}"
  ProjectSponsor                =   "${var.ProjectSponsor}"
  FinanceApprover               =   "${var.FinanceApprover}"
  Critically                   =   "${var.Critically}"
  DataClassification            =   "${var.DataClassification}"
  PII                           =   "${var.PII}"
  HoursofOperation              =   "${var.HoursofOperation}"
  WorkingDays                   =   "${var.WorkingDays}"
  Workinghours                  =   "${var.Workinghours}"
  ExpiringAction                =   "${var.ExpiringAction}"
  ProductionEnvironments        =   "${var.ProductionEnvironments}"
  CloudProvider                 =   "${var.CloudProvider}"
  DescribetheBusinessProblem    =   "${var.DescribetheBusinessProblem}"
  BillingAddress                =   "${var.BillingAddress}"
  Pre-ApprovedBudget          =   "${var.Pre-ApprovedBudget}"
  SupportLevel                   =   "${var.SupportLevel}"
  DANNetworkAccessRequired    =   "${var.DANNetworkAccessRequired}"
  DANDataSource                =   "${var.DANDataSource}"
  AccessNeeded                  =   "${var.AccessNeeded}"
  AccessPattern                 =   "${var.AccessPattern}"
  ReasonforCloudSelection       =   "${var.ReasonforCloudSelection}"
  cidr                          =   "${var.cidr}"
  nbr_az          = "${length(data.aws_availability_zones.available.names)}"
}

# Modules

module "vpc" {
  source = "../vpc"
  
        AppID                          =   "${var.AppID}"
        AppRole                       =   "${var.AppRole}"
        Environment                   =   "${var.Environment}"
        Version                       =   "${var.Version}"
        Cluster                       =   "${var.Cluster}"
        StartingDate                  =   "${var.StartingDate}"
        Owner                         =   "${var.Owner}"
        Tenant                        =   "${var.Tenant}"
        CostCenter                    =   "${var.CostCenter}"
        Costumer                      =   "${var.Costumer}"
        Confidentiality               =   "${var.Confidentiality}"
        ProjectName                   =   "${var.ProjectName}"
        Compliance                    =   "${var.Compliance}"
        Requestor                     =   "${var.Requestor}"
        BusinessOwner                  =   "${var.BusinessOwner}"
        ProjectSponsor                =   "${var.ProjectSponsor}"
        FinanceApprover               =   "${var.FinanceApprover}"
        Critically                    =   "${var.Critically}"
        DataClassification            =   "${var.DataClassification}"
        PII                           =   "${var.PII}"
        HoursofOperation              =   "${var.HoursofOperation}"
        WorkingDays                   =   "${var.WorkingDays}"
        Workinghours                  =   "${var.Workinghours}"
        ExpiringAction                =   "${var.ExpiringAction}"
        ProductionEnvironments        =   "${var.ProductionEnvironments}"
        CloudProvider                 =   "${var.CloudProvider}"
        DescribetheBusinessProblem    =   "${var.DescribetheBusinessProblem}"
        BillingAddress                =   "${var.BillingAddress}"
        Pre-ApprovedBudget          =   "${var.Pre-ApprovedBudget}"
        SupportLevel                   =   "${var.SupportLevel}"
        DANNetworkAccessRequired    =   "${var.DANNetworkAccessRequired}"
        DANDataSource                =   "${var.DANDataSource}"
        AccessNeeded                  =   "${var.AccessNeeded}"
        AccessPattern                 =   "${var.AccessPattern}"
        ReasonforCloudSelection       =   "${var.ReasonforCloudSelection}"
        cidr                          =   "${var.cidr}"
}

module "private_subnets_0" {
  source = "../subnet"
  
        AppID                          =   "${var.AppID}"
        AppRole                       =   "${var.AppRole}"
        Environment                   =   "${var.Environment}"
        Version                       =   "${var.Version}"
        Cluster                       =   "${var.Cluster}"
        StartingDate                  =   "${var.StartingDate}"
        Owner                         =   "${var.Owner}"
        Tenant                        =   "${var.Tenant}"
        CostCenter                    =   "${var.CostCenter}"
        Costumer                      =   "${var.Costumer}"
        Confidentiality               =   "${var.Confidentiality}"
        ProjectName                   =   "${var.ProjectName}"
        Compliance                    =   "${var.Compliance}"
        Requestor                     =   "${var.Requestor}"
        BusinessOwner                  =   "${var.BusinessOwner}"
        ProjectSponsor                =   "${var.ProjectSponsor}"
        FinanceApprover               =   "${var.FinanceApprover}"
        Critically                    =   "${var.Critically}"
        DataClassification            =   "${var.DataClassification}"
        PII                           =   "${var.PII}"
        HoursofOperation              =   "${var.HoursofOperation}"
        WorkingDays                   =   "${var.WorkingDays}"
        Workinghours                  =   "${var.Workinghours}"
        ExpiringAction                =   "${var.ExpiringAction}"
        ProductionEnvironments        =   "${var.ProductionEnvironments}"
        CloudProvider                 =   "${var.CloudProvider}"
        DescribetheBusinessProblem    =   "${var.DescribetheBusinessProblem}"
        BillingAddress                =   "${var.BillingAddress}"
        Pre-ApprovedBudget          =   "${var.Pre-ApprovedBudget}"
        SupportLevel                   =   "${var.SupportLevel}"
        DANNetworkAccessRequired    =   "${var.DANNetworkAccessRequired}"
        DANDataSource                =   "${var.DANDataSource}"
        AccessNeeded                  =   "${var.AccessNeeded}"
        AccessPattern                 =   "${var.AccessPattern}"
        ReasonforCloudSelection       =   "${var.ReasonforCloudSelection}"
        tier                          =   "private"
        vpc_id                        =   "${module.vpc.vpc_id}"
        AvailabilityZone              =   "${data.aws_availability_zones.available.names[0 % local.nbr_az]}"
        cidr_block                    =   "${cidrsubnet(local.cidr, var.subnet_mask, 0)}"
        public_subnet_id              =   "${module.public_subnets_0.subnet_id}"
}

module "private_subnets_1" {
  source = "../subnet"
  
        AppID                          =   "${var.AppID}"
        AppRole                       =   "${var.AppRole}"
        Environment                   =   "${var.Environment}"
        Version                       =   "${var.Version}"
        Cluster                       =   "${var.Cluster}"
        StartingDate                  =   "${var.StartingDate}"
        Owner                         =   "${var.Owner}"
        Tenant                        =   "${var.Tenant}"
        CostCenter                    =   "${var.CostCenter}"
        Costumer                      =   "${var.Costumer}"
        Confidentiality               =   "${var.Confidentiality}"
        ProjectName                   =   "${var.ProjectName}"
        Compliance                    =   "${var.Compliance}"
        Requestor                     =   "${var.Requestor}"
        BusinessOwner                  =   "${var.BusinessOwner}"
        ProjectSponsor                =   "${var.ProjectSponsor}"
        FinanceApprover               =   "${var.FinanceApprover}"
        Critically                    =   "${var.Critically}"
        DataClassification            =   "${var.DataClassification}"
        PII                           =   "${var.PII}"
        HoursofOperation              =   "${var.HoursofOperation}"
        WorkingDays                   =   "${var.WorkingDays}"
        Workinghours                  =   "${var.Workinghours}"
        ExpiringAction                =   "${var.ExpiringAction}"
        ProductionEnvironments        =   "${var.ProductionEnvironments}"
        CloudProvider                 =   "${var.CloudProvider}"
        DescribetheBusinessProblem    =   "${var.DescribetheBusinessProblem}"
        BillingAddress                =   "${var.BillingAddress}"
        Pre-ApprovedBudget          =   "${var.Pre-ApprovedBudget}"
        SupportLevel                   =   "${var.SupportLevel}"
        DANNetworkAccessRequired    =   "${var.DANNetworkAccessRequired}"
        DANDataSource                =   "${var.DANDataSource}"
        AccessNeeded                  =   "${var.AccessNeeded}"
        AccessPattern                 =   "${var.AccessPattern}"
        ReasonforCloudSelection       =   "${var.ReasonforCloudSelection}"
        tier                          =   "private"
        vpc_id                        =   "${module.vpc.vpc_id}"
        AvailabilityZone              =   "${data.aws_availability_zones.available.names[1 % local.nbr_az]}"
        cidr_block                    =   "${cidrsubnet(local.cidr, var.subnet_mask, 1)}"
        public_subnet_id              =   "${module.public_subnets_1.subnet_id}"
}

module "private_subnets_2" {
  source = "../subnet"
  
        AppID                          =   "${var.AppID}"
        AppRole                       =   "${var.AppRole}"
        Environment                   =   "${var.Environment}"
        Version                       =   "${var.Version}"
        Cluster                       =   "${var.Cluster}"
        StartingDate                  =   "${var.StartingDate}"
        Owner                         =   "${var.Owner}"
        Tenant                        =   "${var.Tenant}"
        CostCenter                    =   "${var.CostCenter}"
        Costumer                      =   "${var.Costumer}"
        Confidentiality               =   "${var.Confidentiality}"
        ProjectName                   =   "${var.ProjectName}"
        Compliance                    =   "${var.Compliance}"
        Requestor                     =   "${var.Requestor}"
        BusinessOwner                  =   "${var.BusinessOwner}"
        ProjectSponsor                =   "${var.ProjectSponsor}"
        FinanceApprover               =   "${var.FinanceApprover}"
        Critically                    =   "${var.Critically}"
        DataClassification            =   "${var.DataClassification}"
        PII                           =   "${var.PII}"
        HoursofOperation              =   "${var.HoursofOperation}"
        WorkingDays                   =   "${var.WorkingDays}"
        Workinghours                  =   "${var.Workinghours}"
        ExpiringAction                =   "${var.ExpiringAction}"
        ProductionEnvironments        =   "${var.ProductionEnvironments}"
        CloudProvider                 =   "${var.CloudProvider}"
        DescribetheBusinessProblem    =   "${var.DescribetheBusinessProblem}"
        BillingAddress                =   "${var.BillingAddress}"
        Pre-ApprovedBudget          =   "${var.Pre-ApprovedBudget}"
        SupportLevel                   =   "${var.SupportLevel}"
        DANNetworkAccessRequired    =   "${var.DANNetworkAccessRequired}"
        DANDataSource                =   "${var.DANDataSource}"
        AccessNeeded                  =   "${var.AccessNeeded}"
        AccessPattern                 =   "${var.AccessPattern}"
        ReasonforCloudSelection       =   "${var.ReasonforCloudSelection}"
        tier                          =   "private"
        vpc_id                        =   "${module.vpc.vpc_id}"
        AvailabilityZone              =   "${data.aws_availability_zones.available.names[2 % local.nbr_az]}"
        cidr_block                    =   "${cidrsubnet(local.cidr, var.subnet_mask, 2)}"
        public_subnet_id              =   "${module.public_subnets_2.subnet_id}"
}

module "internet_gateway" {
  source = "../internet_gateway"
  
        AppID                          =   "${var.AppID}"
        AppRole                       =   "${var.AppRole}"
        Environment                   =   "${var.Environment}"
        Version                       =   "${var.Version}"
        Cluster                       =   "${var.Cluster}"
        StartingDate                  =   "${var.StartingDate}"
        Owner                         =   "${var.Owner}"
        Tenant                        =   "${var.Tenant}"
        CostCenter                    =   "${var.CostCenter}"
        Costumer                      =   "${var.Costumer}"
        Confidentiality               =   "${var.Confidentiality}"
        ProjectName                   =   "${var.ProjectName}"
        Compliance                    =   "${var.Compliance}"
        Requestor                     =   "${var.Requestor}"
        BusinessOwner                  =   "${var.BusinessOwner}"
        ProjectSponsor                =   "${var.ProjectSponsor}"
        FinanceApprover               =   "${var.FinanceApprover}"
        Critically                   =   "${var.Critically}"
        DataClassification            =   "${var.DataClassification}"
        PII                           =   "${var.PII}"
        HoursofOperation              =   "${var.HoursofOperation}"
        WorkingDays                   =   "${var.WorkingDays}"
        Workinghours                  =   "${var.Workinghours}"
        ExpiringAction                =   "${var.ExpiringAction}"
        ProductionEnvironments        =   "${var.ProductionEnvironments}"
        CloudProvider                 =   "${var.CloudProvider}"
        DescribetheBusinessProblem    =   "${var.DescribetheBusinessProblem}"
        BillingAddress                =   "${var.BillingAddress}"
        Pre-ApprovedBudget          =   "${var.Pre-ApprovedBudget}"
        SupportLevel                   =   "${var.SupportLevel}"
        DANNetworkAccessRequired    =   "${var.DANNetworkAccessRequired}"
        DANDataSource                =   "${var.DANDataSource}"
        AccessNeeded                  =   "${var.AccessNeeded}"
        AccessPattern                 =   "${var.AccessPattern}"
        ReasonforCloudSelection       =   "${var.ReasonforCloudSelection}"
        vpc_id                        = "${module.vpc.vpc_id}"
}

module "public_subnets_0" {
  source = "../subnet"
  
        AppID                          =   "${var.AppID}"
        AppRole                       =   "${var.AppRole}"
        Environment                   =   "${var.Environment}"
        Version                       =   "${var.Version}"
        Cluster                       =   "${var.Cluster}"
        StartingDate                  =   "${var.StartingDate}"
        Owner                         =   "${var.Owner}"
        Tenant                        =   "${var.Tenant}"
        CostCenter                    =   "${var.CostCenter}"
        Costumer                      =   "${var.Costumer}"
        Confidentiality               =   "${var.Confidentiality}"
        ProjectName                   =   "${var.ProjectName}"
        Compliance                    =   "${var.Compliance}"
        Requestor                     =   "${var.Requestor}"
        BusinessOwner                  =   "${var.BusinessOwner}"
        ProjectSponsor                =   "${var.ProjectSponsor}"
        FinanceApprover               =   "${var.FinanceApprover}"
        Critically                    =   "${var.Critically}"
        DataClassification            =   "${var.DataClassification}"
        PII                           =   "${var.PII}"
        HoursofOperation              =   "${var.HoursofOperation}"
        WorkingDays                   =   "${var.WorkingDays}"
        Workinghours                  =   "${var.Workinghours}"
        ExpiringAction                =   "${var.ExpiringAction}"
        ProductionEnvironments        =   "${var.ProductionEnvironments}"
        CloudProvider                 =   "${var.CloudProvider}"
        DescribetheBusinessProblem    =   "${var.DescribetheBusinessProblem}"
        BillingAddress                =   "${var.BillingAddress}"
        Pre-ApprovedBudget          =   "${var.Pre-ApprovedBudget}"
        SupportLevel                   =   "${var.SupportLevel}"
        DANNetworkAccessRequired    =   "${var.DANNetworkAccessRequired}"
        DANDataSource                =   "${var.DANDataSource}"
        AccessNeeded                  =   "${var.AccessNeeded}"
        AccessPattern                 =   "${var.AccessPattern}"
        ReasonforCloudSelection       =   "${var.ReasonforCloudSelection}"
        tier                          =   "public"
        vpc_id                        =   "${module.vpc.vpc_id}"
        AvailabilityZone              =   "${data.aws_availability_zones.available.names[0 % local.nbr_az]}"
        cidr_block                    =   "${cidrsubnet(local.cidr, var.subnet_mask, 3)}"
        public_rt_id                  =   "${module.internet_gateway.route_table_id}"
}

module "public_subnets_1" {
  source = "../subnet"
  
        AppID                          =   "${var.AppID}"
        AppRole                       =   "${var.AppRole}"
        Environment                   =   "${var.Environment}"
        Version                       =   "${var.Version}"
        Cluster                       =   "${var.Cluster}"
        StartingDate                  =   "${var.StartingDate}"
        Owner                         =   "${var.Owner}"
        Tenant                        =   "${var.Tenant}"
        CostCenter                    =   "${var.CostCenter}"
        Costumer                      =   "${var.Costumer}"
        Confidentiality               =   "${var.Confidentiality}"
        ProjectName                   =   "${var.ProjectName}"
        Compliance                    =   "${var.Compliance}"
        Requestor                     =   "${var.Requestor}"
        BusinessOwner                  =   "${var.BusinessOwner}"
        ProjectSponsor                =   "${var.ProjectSponsor}"
        FinanceApprover               =   "${var.FinanceApprover}"
        Critically                    =   "${var.Critically}"
        DataClassification            =   "${var.DataClassification}"
        PII                           =   "${var.PII}"
        HoursofOperation              =   "${var.HoursofOperation}"
        WorkingDays                   =   "${var.WorkingDays}"
        Workinghours                  =   "${var.Workinghours}"
        ExpiringAction                =   "${var.ExpiringAction}"
        ProductionEnvironments        =   "${var.ProductionEnvironments}"
        CloudProvider                 =   "${var.CloudProvider}"
        DescribetheBusinessProblem    =   "${var.DescribetheBusinessProblem}"
        BillingAddress                =   "${var.BillingAddress}"
        Pre-ApprovedBudget          =   "${var.Pre-ApprovedBudget}"
        SupportLevel                   =   "${var.SupportLevel}"
        DANNetworkAccessRequired    =   "${var.DANNetworkAccessRequired}"
        DANDataSource                =   "${var.DANDataSource}"
        AccessNeeded                  =   "${var.AccessNeeded}"
        AccessPattern                 =   "${var.AccessPattern}"
        ReasonforCloudSelection       =   "${var.ReasonforCloudSelection}"
        tier                          =   "public"
        vpc_id                        =   "${module.vpc.vpc_id}"
        AvailabilityZone              =   "${data.aws_availability_zones.available.names[1 % local.nbr_az]}"
        cidr_block                    =   "${cidrsubnet(local.cidr, var.subnet_mask, 4)}"
        public_rt_id                  =   "${module.internet_gateway.route_table_id}"
}

module "public_subnets_2" {
  source = "../subnet"
  
        AppID                          =   "${var.AppID}"
        AppRole                       =   "${var.AppRole}"
        Environment                   =   "${var.Environment}"
        Version                       =   "${var.Version}"
        Cluster                       =   "${var.Cluster}"
        StartingDate                  =   "${var.StartingDate}"
        Owner                         =   "${var.Owner}"
        Tenant                        =   "${var.Tenant}"
        CostCenter                    =   "${var.CostCenter}"
        Costumer                      =   "${var.Costumer}"
        Confidentiality               =   "${var.Confidentiality}"
        ProjectName                   =   "${var.ProjectName}"
        Compliance                    =   "${var.Compliance}"
        Requestor                     =   "${var.Requestor}"
        BusinessOwner                  =   "${var.BusinessOwner}"
        ProjectSponsor                =   "${var.ProjectSponsor}"
        FinanceApprover               =   "${var.FinanceApprover}"
        Critically                    =   "${var.Critically}"
        DataClassification            =   "${var.DataClassification}"
        PII                           =   "${var.PII}"
        HoursofOperation              =   "${var.HoursofOperation}"
        WorkingDays                   =   "${var.WorkingDays}"
        Workinghours                  =   "${var.Workinghours}"
        ExpiringAction                =   "${var.ExpiringAction}"
        ProductionEnvironments        =   "${var.ProductionEnvironments}"
        CloudProvider                 =   "${var.CloudProvider}"
        DescribetheBusinessProblem    =   "${var.DescribetheBusinessProblem}"
        BillingAddress                =   "${var.BillingAddress}"
        Pre-ApprovedBudget          =   "${var.Pre-ApprovedBudget}"
        SupportLevel                   =   "${var.SupportLevel}"
        DANNetworkAccessRequired    =   "${var.DANNetworkAccessRequired}"
        DANDataSource                =   "${var.DANDataSource}"
        AccessNeeded                  =   "${var.AccessNeeded}"
        AccessPattern                 =   "${var.AccessPattern}"
        ReasonforCloudSelection       =   "${var.ReasonforCloudSelection}"
        tier                          =   "public"
        vpc_id                        =   "${module.vpc.vpc_id}"
        AvailabilityZone              =   "${data.aws_availability_zones.available.names[2 % local.nbr_az]}"
        cidr_block                    =   "${cidrsubnet(local.cidr, var.subnet_mask, 5)}"
        public_rt_id                  =   "${module.internet_gateway.route_table_id}"
}
